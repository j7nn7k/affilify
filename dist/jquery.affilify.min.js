/*
 *  jquery-affilify - v0.0.1
 *  A jquery plugin to replace links with affiliate links on the fly. Support for Amazon, Affilinet, Zanox.
 *  https://github.com/j7nn7k/affilifyt
 *
 *  Made by Jannik Weyrich
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$el=a(b),this.originalUrl=this.$el.attr("href")||"",this.originalDomain=this.extractDomain(this.originalUrl),this.affiliateUrl=this.originalUrl,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.areSettingsValid()&&this.init()}var f="affilify",g={zanoxPublisherId:"",amazonPublisherId:"",affilinet:{publisherId:"",programs:[{domain:"",siteId:""}]}};a.extend(e.prototype,{init:function(){var a=this;this.$el.click(function(c){a.shouldReplaceLink()&&(c.preventDefault(),a.isAmazon()?a.makeAmazon():a.isZanox()?a.makeZanox():a.isAffilinet()&&a.makeAffilinet(),b.location.href=a.affiliateUrl)})},shouldReplaceLink:function(){return this.$el.attr("data-noaffiliatereplace")===d},extractDomain:function(){var a,b;return this.originalUrl.indexOf("://")>-1?(b=this.originalUrl.split("://")[0]+"://",a=this.originalUrl.split("/")[2]):a=this.originalUrl.split("/")[0],a=a.split(":")[0],b+a},makeZanox:function(){this.affiliateUrl="https://ad.zanox.com/ppc/?"+this.settings.zanoxPublisherId+"&ulp=[["+this.originalUrl+"?utm_source=zanox&utm_campaign=deeplinkzx_de&affil=zanox]]"},isZanox:function(){return this.originalDomain.indexOf("myprotein")>-1||this.originalDomain.indexOf("vaola.de")>-1},isAmazon:function(){return this.originalDomain.indexOf("amazon")>-1},isAffilinet:function(){var a=this,b=!1;return this.settings.affilinet.programs.forEach(function(c){return c.domain&&a.originalDomain.indexOf(c.domain)>-1?void(b=!0):void 0}),b},makeAffilinet:function(){var a=this;this.settings.affilinet.programs.forEach(function(b){a.originalDomain.indexOf(b.domain)>-1&&(a.affiliateUrl="http://partners.webmasterplan.com/click.asp?ref="+a.settings.affilinet.publisherId+"&site="+b.siteId+"&type=text&tnb=1&diurl="+encodeURIComponent(a.originalUrl))})},makeAmazon:function(){this.originalUrl.indexOf("?tag=")>-1||this.originalUrl.indexOf("&tag=")>-1?this.affiliateUrl=this.replaceQueryParam(this.originalUrl,"tag",this.settings.amazonPublisherId):this.affiliateUrl=this.originalUrl+"&tag="+this.settings.amazonPublisherId},replaceQueryParam:function(a,b,c){var d=new RegExp("\\b("+b+"=).*?(&|$)");return a.search(d)>=0?a.replace(d,"$1"+c+"$2"):a+(a.indexOf("?")>0?"&":"?")+b+"="+c},areSettingsValid:function(){if(this.settings.affilinet&&this.settings.affilinet.programs&&this.settings.affilinet.programs.constructor!==Array)throw new Error("The affilinet *programs* property should be an array or left out altogether.");return!0}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);